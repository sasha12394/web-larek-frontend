# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Товар

```
export interface IProduct{
  _id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number|null;
}
```

Заказчик

```
export interface IOrder{
  payment: string;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

Интерфейс для хранения коллекций товаров

```
export interface IProductData{
  products: IProduct[];
  preview: string|null;
}
```

Интерфейс для отображения корзины на главной странице

```
export interface IBasket{
  total: number|null;
}
```

Данные товара, используемые в модальном окне

```
export type TProductModal = Pick<IProduct, 'description'|'image'|'title'|'category'|'price'>
```

Данные заказчика, которые находятся в модульном окне "Корзины"

```
export type TBasket = Pick<IOrder, 'total'|'items'>
```

Данные формы заказа, которые находятся в первом модульном окне "Оформление заказа"

```
export type TOrderStart = Pick<IOrder, 'payment'|'address'>
```

Данные формы заказа, которые находятся во втором модульном окне "Оформление заказа"

```
export type TOrderEnd = Pick<IOrder, 'phone'|'email'>
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных,
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс API
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы:
- `get` - выполняет `GET` запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный,как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных 

#### Класс ProductData
Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _product: IProduct[] - массив объектов товаров
- _preview: string | null - id товара, выбранного для просмотра в модальном окне

Так же класс представляет набор методов для взаимодействия с этими данными.
- getProduct(cardId:string): IProduct - возвращает карточку по её id
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс OrderData

Класс отвечает за хранение и логику работы с данными заказа.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _payment: string - способ оплаты
- _email: string - emai заказчика
- _phone: string - телнфон заказчика
- _address: string - адрес заказчика
- _total: number - общая сумма заказа
- _items: string[] - товары в заказе
- events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Так же класс представляет набор методов для взаимодействия с этими данными.

- setOrder(orderData: IOrder): void - сохраняет данные заказа в классе
- checkOrderStartValidation (data: (Record<keyof TOrderStart, string>)):boolean - проверяет объект с данными заказа на валидность
- checkOrderEndValidation (data: (Record<keyof TOrderEnd, string>)):boolean - проверяет объект с данными заказа на валидность

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных
#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управленияотображения модального окна. Устанавливает слушатель на клавиатуру, для закрытия модально окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

- constructor(selector: string, events:IEvent)Конструктор принимает селектор, по которосу в разметкестраницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициалиации событий

Поля класса:
- modal: HTMLElement - элемент модального окна
- event: IEvent - брокер событий

#### Класс ModalForm
Расширяет класс Modal. Предназначен для реализация модального окна с формой, содержащей поля ввода с подтверждением действий. При сабмите инициируется событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициируется событие изменения данных. Предоставляет метод для отображения ошибок и управления активностью кнопки "Далее" и "Отправить".\
Поля класса:
- submitButton: HTMLButtonElement - кнопка подтверждения
- _form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей формы
- errors: Record<string, HTMLElement> - объект хранящий все эдементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы:
- setValid(isValid:boolean): void - изменяет активность кнопки подтверждения
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError (field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError (field: string): void - очищает текст ошибки под указанным полем ввода
- close(): void - расширяет родительский метод дополнительно при закрытии, очишаея поля формы и деактивируя кнопки продолжения заказа

#### Класс Product

Отвечает за отображение карточек товаров,проверку наличия товара в корзине. Используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при ниобходимости менять наполнение верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми генерируется соответствующие события.\
Поля класса содержат элементы разетки карточки товаров. Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
- setData(productData: IProduct): void - заполняет атрибуты элементов карточки товаров данными
- isInBasket(): boolean - метод возвращает наличие данного товара в корзине
- render(): HTMLElement - метод возвращает полностью заполненную карточку товара с установленными слушателями
- геттер id - возвращает уникальный id товара

#### Класс ProductContainer
Отвечает за отображение блока со всеми товарами на главной странице. В конструктор принимает контейнер, в котором размещаются карточки товаров. 

#### Класс ModulBasket
Отвечает за отображение товаров в корзине, кнопки удаления определенного товара, общей стоимости заказа.
Класс содержит поля:
- _total: number - для отображения полной стоимости заказа
- _items: string[] - массив товаров, которые были добавлены в корзину
- _container: HTMLLIElement - контейнер для элемента корзины

Методы:
- setProduct (_items: string[]): void - заполняет содержимое корзины, выбранными товарами
- deleteProduct(idProduct:string): void - метод для удаления товара из корзины
- render(): HTMLElement - метод возвращает заполненную корзину с установленными слушателями 
- setTotal(_total: number): void - устанавливает общую сумму заказа
- clear(): void - очищает корзину, устанавливая содержимое

#### Класс Basket

Отвечает за отображение количества товаров в корзине на главной странице.
Методы:
- setTotal(value: number) - Устанавливает общее количество товаров

#### Класс ModuleSuccess
Расширяет класс Modal.\
Класс отображает сообщение об успешном завершении заказа

Методы:
- setTotal(value: number) - Устанавливает общую сумму списания

### Слой коммууникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, который выполняет роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В данном файле сначала создаются эземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*Событие изменения данных(генерируются классами моделями данных)*
- `product:selected` - изменения открываемой в модальном окне информации товара
- `basket:changed` - изменения в открываемом модельном окне корзины
- `total-price:changed` - изменения общей цены заказа
- `basket-number:changed` - изменение колличества товаров в корзине на главной странице

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируется классами, отвечающими за представление)*
- `basket:open` - открытие модального окна корзины
- `order-start:open` - открытие модального окна начала заказа с формой адреса
- `product-in-basket:select` - выбор товара для добавления в корзину
- `product-in-basket:delete` - удаление товара из корзины
- `order-further:open` - открытие модального окна продолжения заказа с формами телефона и email
- `product:select` - выбор карточки товара для открытия в модальном окне
- `product:previwClear` - очистка данных выбранной для показа в модальном окне карточке товара
- `payment:select` - выбор способа оплаты
- `order-adress:input` - изменение данных в форме введения адреса заказа
- `order-adress:submit` - сохранение данных адреса заказа введенных в форме адреса
- `order-adress:validation` - событие, сообщающее о необходимости валидации формы адреса заказа
- `order-phone:input` - изменение данных в форме введения телефона заказа
- `order-further:submit`- сохранение данных телефора и email заказа введенных в формах
- `order-phone:validation`- событие, сообщающее о необходимости валидации формы телефона заказа
- `order-email:input`- изменение данных в форме введения email заказа
- `order-email:validation`- событие, сообщающее о необходимости валидации формы email заказа
