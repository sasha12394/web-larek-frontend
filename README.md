# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Товар

```
export interface IProduct{
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number|null;
  disabled: boolean;
}
```

Заказчик

```
export interface IOrder{
  payment?: string;
  email?: string;
  phone?: string;
  address?: string;
}
```

Интерфейс для хранения коллекций товаров

```
export interface IProductData{
  products: IProduct[];
  preview: string|null;
}
```

Интерфейс для отображения корзины на главной странице

```
export type TProductBasket = Pick<IProduct, 'id'| 'title'|'price'>

```

Данные товара, используемые в модальном окне

```
export type TProductModal = Pick<IProduct, 'description'|'image'|'title'|'category'|'price'>
```

Данные формы заказа, которые находятся в первом модульном окне "Оформление заказа"

```
export type TOrderStart = Pick<IOrder, 'payment'|'address'>
```

Данные формы заказа, которые находятся во втором модульном окне "Оформление заказа"

```
export type TOrderEnd = Pick<IOrder, 'phone'|'email'>
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных,
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс API
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы:
- `get` - выполняет `GET` запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный,как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс Component
Абстрактный класс, который служит базовым компонентом для остальных компонентов интерфейса. В нем представлен инструментарий для работы с DOM в дочерних компонентах

Методы:
- toggleClass() - переключить класс
- setText() - установить текстовое содержимое
- setDisabled() - сменить статус блокировки
- setHidden() - скрыть
- setVisible() - показать
-setImage() - установить изображение с алтернативным текстом
- render() - вернуть корневой DOM-элемент

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных 

#### Класс ProductData
Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _product: IProduct[] - массив объектов товаров
- _preview: IProduct|null; - id товара, выбранного для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Так же класс представляет набор методов для взаимодействия с этими данными.
- getProduct(productId:string): IProduct - возвращает карточку по её id
- setProducts(products: IProduct[]): void - получат массив карточек для вывода на страницу
- setPreview(products: IProduct): void - получат карточку для вывода на страницу в модальном окне
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс OrderData

Класс отвечает за хранение и логику работы с данными заказа.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- _formErrors: TFormErrors - ошибки валидации форм
- _order: IOrder - объект с данными заказа, включает в себя поля:
1. payment: string - способ оплаты
2. email: string - emai заказчика
3. phone: string - телнфон заказчика
4. address: string - адрес заказчика


Так же класс представляет набор методов для взаимодействия с этими данными.

- setOrderPayment(value: PaymentType) - сохраняет способ оплаты заказа в классе
- setOrderEmail(value: string) - сохраняет email заказа в классе
- setOrderAddress(value: string) - сохраняет адрес заказа в классе
- setOrderPhone(value: string) - сохраняет телефон заказа в классе
- setOrderField(field: keyof TOrderInput, value: string) -обновляет любое поле заказа и инициирует валидацию.
- clearOrder() - очищает формы заказа, после успешной оплаты
- validateOrder():boolean - проверяет объект с данными заказа на валидность
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс BasketData
Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- orderBasket:  TProductBasket[] - массив продуктов, добавленных в корзину
- events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных.

Так же класс представляет набор методов для взаимодействия с этими данными.
- addToBasket(product: TProductBasket) - добавляет продукт в корзину
- removeFromBasket(product: TProductBasket) - удаляет продукт из корзины
- getTotal() - вычисляет и возвращает общую сумму в корзине
- clearBasket() - очищает корзину
- getBasketLength() - возвращает количество продуктов в корзине
- isInBasket(product: IProduct) - проверка нахождения конкретного продукта в корзине
- getOderId() - получение массива id карточек товаров, добавленных в корзину
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных
#### Класс Modal
Класс наследуется от родительского класса `Component`.
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управленияотображения модального окна. Устанавливает слушатель на клик в оверлей и кнопку-крестик для закрытия попапа.

- constructor(selector: string, events:IEvent)Конструктор принимает селектор, по которосу в разметкестраницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициалиации событий

Поля класса:
- _content: HTMLElement - элемент модального окна
- _closeButton: HTMLButtonElement - кнопка закрытия модального окна
- event: IEvent - брокер событий

#### Класс Form
Класс наследуется от родительского класса `Component`.
Предназначен для реализация модального окна с формой, содержащей поля ввода с подтверждением действий. При сабмите инициируется событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициируется событие изменения данных. Предоставляет метод для отображения ошибок и управления активностью кнопки "Далее" и "Отправить".\
Поля класса:
- _submit: HTMLButtonElement - кнопка подтверждения
- _errors: HTMLElement - объект хранящий все эдементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы:
- set valid - проверяет валидность форму и изменяет активность кнопки подтверждения
- set errors - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода


#### Класс Card
Класс наследуется от родительского класса `Component`.
Отвечает за отображение карточек товаров,проверку наличия товара в корзине. Используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при ниобходимости менять наполнение верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми генерируется соответствующие события.\
Поля класса содержат элементы разетки карточки товаров. Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
- сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс Page
Класс наследуется от родительского класса `Component`.
Отвечает за отображение блока со всеми товарами на главной странице. В конструктор принимает контейнер, в котором размещаются карточки товаров. 
Класс содержит поля:
- _counter: HTMLElement - счетчик количества товаров в корзине
- _catalog: HTMLElement - каталог товаров
- _wrapper: HTMLElement - обертка страницы
- _basket: HTMLElement - кнопка корзины на странице

#### Класс Basket
Класс наследуется от родительского класса `Component`.
Отвечает за отображение товаров в корзине, кнопки удаления определенного товара, общей стоимости заказа.
Класс содержит поля:
- _total: number - для отображения полной стоимости заказа
- _button - кнопка формления заказа
- _list: HTMLLIElement - контейнер для элемента корзины

Методы:
- disabledButton() - отвечает за состояние кнопки оформления заказа из корзины
- set items - заполняет содержимое корзины, выбранными товарами
- set total - устанавливает общую сумму заказа

#### Класс OrderStart
Класс наследуется от родительского класса `Form`.
Отвечает за отображение адреса в форме заказа и выбора способа оплаты заказа
Класс содержит поля:
- _buttonCard: HTMLButtonElement - кнопка для выбора оплаты заказа картой
- _buttonCash: HTMLButtonElement - кнопка для выбора оплаты заказа наличными
- _address: HTMLInputElement - поле ввода адреса

Методы:
- set address - устанавливает значение в поле ввода адреса
- togglePayment(value: HTMLElement) - уставнавливает активное состояние выбранной кнопке способа оплаты
- resetPayment() - сбрасывает активное состояние кнопки, которая не выбранна

#### Класс OrderEnd
Класс наследуется от родительского класса `Form`.
Отвечает за отображение телефона и email в форме заказа
Класс содержит поля:
- _email: HTMLInputElement - поле ввода email
- _phone: HTMLInputElement - поле ввода телефона

Методы:
- set phone - устанавливает значение в поле ввода телефона
- set email - устанавливает значение в поле ввода email

#### Класс Success
Класс наследуется от родительского класса `Component`.
Класс отображает сообщение об успешном завершении заказа

Методы:
- set total - Устанавливает общую сумму списания

### Слой коммууникации

#### Класс LarekApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.
Класс содержит методы:
- getProductItem(id: string): Promise<IProduct> - возвращает продукт по его id
- getProductList(): Promise<IProduct[]> - возвращает массив продуктов с их изображениями
-  orderProducts(order: IOrder): Promise<IOrder> - отправляет заказ на сервер

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, который выполняет роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В данном файле сначала создаются эземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*Событие изменения данных(генерируются классами моделями данных)*
- `preview:changed` - изменения открываемой в модальном окне информации товара
- `basket:changed` - изменения в открываемом модельном окне корзины
- `product:change` - изменение массива карточек продукта

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируется классами, отвечающими за представление)*
- `basket:open` - открытие модального окна корзины
- `order-start:open` - открытие модального окна начала заказа с формой адреса
- `order-start:change` - изменения модального окна начала заказа с формой адреса
- `product-in-basket:select` - выбор товара для добавления в корзину
- `product:select` - выбор карточки товара для открытия в модальном окне

- `modal:open` - блокируем прокрутку страницы если открыта модалка
- `modal:close` - разблокируем прокрутку страницы если открыта модалка
- `order:submit` - сохранение данных адреса заказа введенных в форме адреса и открытие модального окна с продолжением заказа
- `/^order\..*:changed/` - событие, сообщающее о необходимости валидации полей 
- `order-phone:input` - изменение данных в форме введения телефона заказа
- `contacts:submit` - событие отправляетр сформированный заказ на сервер, открывает моадльное окно успешного выполнения заказа и очищает корзину